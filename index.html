<!DOCTYPE HTML>
<html class='no-js'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' />
    <title>Branches of Madison County</title>
    <script>document.documentElement.className='js'</script>
    <link rel='stylesheet' media='all' href='page.css' />
    <style>
      #scoreboard {
        border-collapse: collapse;
        float: left;
      }

      #scoreboard tr.active {
        background: #ccc;
      }

      #scoreboard tbody tr {
        cursor: pointer;
      }

      #strokes {
        width: 100px;
        margin: 0 auto 24px;
      }
    </style>
  </head>
  <body>
    <noscript>Javascript required.  Sowwy!</noscript>
    <table id='scoreboard'>
      <thead>
        <tr><td>Level</td><td>Par</td><td>Best</td></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id='strokes'>Strokes: <span></span></div>
    <div id='field'></div>
    <script src='vendor/jquery.js'></script>
    <script src='vendor/jquery.ba-hashchange.js'></script>
    <script src='src/branches.js'></script>
    <script>
      var levelsData = [
        {name: 'dot', par: 5, target: '   O   \n XXXXXXXXXXXXXXXXX '}
      , {name: 'hrt', par: 25, target: ' OO OO \n O OO O \n O  O  O \n  O    O  \n   O   O   \n    O  O    \n     O O     \n      OO      \n       O       \n XXXXXXXXXXXXXXXXX '}
      , {name: 'seg', par: 25, target: '  OOOOOOOO  \n XXXXXXXXXXXXXXXXX '}
      , {name: 'hex', par: 20, target: ' OOO \n O  O \n O   O \n  O  O  \n   OOO   \n XXXXXXXXXXXXXXXXX '}
      , {name: 'pyr', par: 95, target: ' OO \n OOOOO \n OOOOOOOO \n OOOOOOOOOOO \n OOOOOOOOOOOOOO \n XXXXXXXXXXXXXXXXX '}
      , {name: 'rad', par: 50, target: ' OOOOO \n O    O \n OO   OO \n OOO  OOO \n O       O \n  O      O  \n   O  O  O   \n    O OO O    \n     OOOOO     \n XXXXXXXXXXXXXXXXX '}
      , {name: 'sno', par: 70, target: ' OO  OO \n OO   OO \n   O  O   \n    O O    \n O   OO   O \n OOOOOOOOOOO \n  O   OO   O  \n      O O      \n      O  O      \n     OO   OO     \n      OO  OO      \n XXXXXXXXXXXXXXXXX '}
      , {name: 'srp', par: 105, target: ' O \n OO \n O O \n OOOO \n O   O \n OO  OO \n O O O O \n OOOOOOOO \n O       O \n OO      OO \n O O     O O \n OOOO    OOOO \n O   O   O   O \n OO  OO  OO  OO \n O O O O O O O O \n OOOOOOOOOOOOOOOO \n XXXXXXXXXXXXXXXXX '}
      ];

      var levels = Branches.Levels(levelsData, localStorage);
      function redrawScoreboard(activeLevel) {
        var $scoreboard = $('#scoreboard tbody').empty();
        var scores = levels.scores();
        $.each(scores, function(i, score) {
          var $row = $('<tr id="' + score.name + '"><td>' + i + '</td><td>' + score.par + '</td><td>' + (score.stroke || '') + '</td></tr>').appendTo($scoreboard);
          if(score.name == activeLevel) {
            $row.addClass('active');
          }
          $row.click(function() {
            location.hash = score.name;
          });
        });
      }
      redrawScoreboard();

      $(window).hashchange(function() {
        var name = location.hash.replace('#', '');
        var $row = $(location.hash);
        if($row.hasClass('active')) {
          return;
        }
        $('#scoreboard tr').removeClass('active');
        $row.addClass('active');
        Branches.ui.Game(levels.level(name), $('#field'), function(game) {
          $('#strokes span').text(game.strokes());
          if(game.complete()) {
            levels.stroke(game.name, game.strokes());
            redrawScoreboard(game.name);
          }
        });
      });

      if(location.hash) {
        $(window).hashchange();
      } else {
        location.hash = levelsData[0].name;
      }
    </script>
  </body>
</html>
